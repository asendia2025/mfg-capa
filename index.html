<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ASENDIA Capacity Planner</title>
    <link rel="icon" type="image/png" href="img/logo_company.png">

    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Varela+Round&display=swap" rel="stylesheet">
    
    <script src="ct_pages/2k_rfg_standard_ct.js"></script> <script src="ct_pages/1k_rfg_standard_ct.js"></script> <script src="ct_pages/drfm_standard_ct.js"></script>    <script src="ct_pages/srfm_standard_ct.js"></script>    <script src="ct_pages/osrfm_standard_ct.js"></script>   <script src="ct_pages/quantum_ct.js"></script>
    <script src="ct_pages/tykon_ct.js"></script>

    <script>
        // [TailwindCSS 설정] 폰트 및 색상 테마 정의
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['"Varela Round"', 'sans-serif'], 
                    },
                    colors: {
                        zinc: {
                            50: '#fafafa', 100: '#f4f4f5', 200: '#e4e4e7', 300: '#d4d4d8', 400: '#a1a1aa',
                            500: '#71717a', 600: '#52525b', 700: '#3f3f46', 800: '#27272a', 900: '#18181b',
                        }
                    }
                }
            }
        }
    </script>
    <style>
        /* [스타일 커스텀] 스크롤바, 애니메이션, 입력창 스타일 */
        body, input, select, button, textarea { font-family: 'Varela Round', sans-serif !important; }
        
        /* 스크롤바 디자인 */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background-color: #d4d4d8; border-radius: 20px; }
        
        /* 페이드인 애니메이션 */
        .fade-in { animation: fadeIn 0.4s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* 숫자 입력창 화살표 제거 */
        input[type=number]::-webkit-inner-spin-button, 
        input[type=number]::-webkit-outer-spin-button { 
            -webkit-appearance: none; margin: 0; 
        }
        
        /* 서브메뉴 애니메이션 */
        .submenu { transition: max-height 0.3s ease-in-out, opacity 0.3s ease-in-out; overflow: hidden; }
        .submenu.closed { max-height: 0; opacity: 0; }
        .submenu.open { max-height: 1000px; opacity: 1; }
    </style>
</head>
<body class="bg-zinc-200 min-h-screen flex items-center justify-center p-4 selection:bg-zinc-800 selection:text-white overflow-hidden">

    <div class="w-full max-w-[1400px] h-[92vh] bg-white rounded-2xl shadow-2xl flex flex-col overflow-hidden relative border border-zinc-200">
        
        <div class="h-12 bg-zinc-50 border-b border-zinc-200 flex items-center justify-between px-6 shrink-0 z-30">
            <div class="flex items-center gap-2">
                <div class="w-3 h-3 rounded-full bg-red-400/80 hover:bg-red-500 transition-colors"></div>
                <div class="w-3 h-3 rounded-full bg-amber-400/80 hover:bg-amber-500 transition-colors"></div>
                <div class="w-3 h-3 rounded-full bg-green-400/80 hover:bg-green-500 transition-colors"></div>
            </div>
            <div class="flex-1 max-w-xl bg-white border border-zinc-200 rounded-md h-7 flex items-center justify-center text-xs text-zinc-400 tracking-wide mx-4">
                <i data-lucide="lock" class="w-3 h-3 mr-2 opacity-50"></i>
                mfg.tech.center/planner
            </div>
            <div class="w-14"></div>
        </div>

        <div class="flex flex-1 overflow-hidden">
            
            <aside class="w-64 bg-zinc-50/80 border-r border-zinc-200 flex flex-col py-8 px-6 backdrop-blur-sm overflow-y-auto">
                <div class="flex-1">
                    <div class="flex items-center gap-3 mb-8">
                        <div class="w-9 h-9 bg-zinc-900 rounded-lg flex items-center justify-center text-white shadow-lg">
                            <i data-lucide="activity" class="w-5 h-5"></i>
                        </div>
                        <div>
                            <span class="font-bold text-lg tracking-tight text-zinc-900 block leading-none">Capacity</span>
                            <span class="font-bold text-lg tracking-tight text-zinc-900 block leading-none">Planner</span>
                        </div>
                    </div>

                    <nav class="space-y-1">
                        <p class="px-3 text-[10px] font-bold text-zinc-400 uppercase tracking-widest mb-2 mt-4">Analysis</p>
                        <button onclick="loadPage('monthly_capa.html', this)" id="nav-trend" class="w-full flex items-center gap-3 px-3 py-2.5 rounded-lg text-zinc-500 hover:bg-zinc-100 hover:text-zinc-900 text-sm font-medium transition-all text-left">
                            <i data-lucide="bar-chart-2" class="w-4 h-4"></i> Monthly Capacity Trend
                        </button>
                    </nav>

                    <nav class="space-y-1 mt-4">
                        <p class="px-3 text-[10px] font-bold text-zinc-400 uppercase tracking-widest mb-2">Modules</p>
                        <button onclick="switchTab('rfg')" id="nav-rfg" class="w-full flex items-center gap-3 px-3 py-2.5 rounded-lg bg-zinc-200 text-zinc-900 text-sm font-medium transition-all text-left">
                            <i data-lucide="cpu" class="w-4 h-4"></i> RF Generator
                        </button>
                        <button onclick="switchTab('rfm')" id="nav-rfm" class="w-full flex items-center gap-3 px-3 py-2.5 rounded-lg text-zinc-500 hover:bg-zinc-100 hover:text-zinc-900 text-sm font-medium transition-all text-left">
                            <i data-lucide="layers" class="w-4 h-4"></i> RF Matcher
                        </button>
                        <button onclick="switchTab('evc')" id="nav-evc" class="w-full flex items-center gap-3 px-3 py-2.5 rounded-lg text-zinc-500 hover:bg-zinc-100 hover:text-zinc-900 text-sm font-medium transition-all text-left">
                            <i data-lucide="zap" class="w-4 h-4"></i> EVC
                        </button>
                    </nav>

                    <div class="border-t border-zinc-200 my-4 mx-2"></div>

                    <nav class="space-y-1">
                        <button onclick="toggleCTMenu()" class="w-full flex items-center justify-between px-3 mb-2 group">
                            <span class="text-[10px] font-bold text-zinc-400 uppercase tracking-widest group-hover:text-zinc-600 transition-colors">Modules_CT</span>
                            <i id="ct-chevron" data-lucide="chevron-down" class="w-3 h-3 text-zinc-400 group-hover:text-zinc-600 transition-transform duration-300"></i>
                        </button>

                        <div id="ct-menu-content" class="submenu open space-y-4 pl-2">
                            <div>
                                <p class="px-2 text-[10px] font-bold text-zinc-500 mb-1 flex items-center gap-1"><i data-lucide="cpu" class="w-3 h-3"></i> RF Generator</p>
                                <div class="pl-3 border-l border-zinc-200 space-y-1">
                                    <button onclick="loadPage('ct_pages/1k_rfg_ct.html', this)" class="ct-link w-full text-left px-2 py-1.5 text-xs text-zinc-500 hover:text-zinc-900 hover:bg-zinc-100 rounded-md transition-colors">1k Platform</button>
                                    <button onclick="loadPage('ct_pages/2k_rfg_ct.html', this)" class="ct-link w-full text-left px-2 py-1.5 text-xs text-zinc-500 hover:text-zinc-900 hover:bg-zinc-100 rounded-md transition-colors">2k Platform</button>
                                    <button onclick="loadPage('ct_pages/2k_rfg_old_ct.html', this)" class="ct-link w-full text-left px-2 py-1.5 text-xs text-zinc-500 hover:text-zinc-900 hover:bg-zinc-100 rounded-md transition-colors">2k Old Platform</button>
                                </div>
                            </div>
                            <div>
                                <p class="px-2 text-[10px] font-bold text-zinc-500 mb-1 flex items-center gap-1"><i data-lucide="layers" class="w-3 h-3"></i> RF Matcher</p>
                                <div class="pl-3 border-l border-zinc-200 space-y-1">
                                    <button onclick="loadPage('ct_pages/srfm_ct.html', this)" class="ct-link w-full text-left px-2 py-1.5 text-xs text-zinc-500 hover:text-zinc-900 hover:bg-zinc-100 rounded-md transition-colors">SRFM</button>
                                    <button onclick="loadPage('ct_pages/osrfm_ct.html', this)" class="ct-link w-full text-left px-2 py-1.5 text-xs text-zinc-500 hover:text-zinc-900 hover:bg-zinc-100 rounded-md transition-colors">OSRFM</button>
                                    <button onclick="loadPage('ct_pages/drfm_ct.html', this)" class="ct-link w-full text-left px-2 py-1.5 text-xs text-zinc-500 hover:text-zinc-900 hover:bg-zinc-100 rounded-md transition-colors">DRFM</button>
                                </div>
                            </div>
                            <div>
                                <p class="px-2 text-[10px] font-bold text-zinc-500 mb-1 flex items-center gap-1"><i data-lucide="zap" class="w-3 h-3"></i> EVC</p>
                                <div class="pl-3 border-l border-zinc-200 space-y-1">
                                    <button onclick="loadPage('ct_pages/quantum_ct.html', this)" class="ct-link w-full text-left px-2 py-1.5 text-xs text-zinc-500 hover:text-zinc-900 hover:bg-zinc-100 rounded-md transition-colors">Quantum</button>
                                    <button onclick="loadPage('ct_pages/tykon_ct.html', this)" class="ct-link w-full text-left px-2 py-1.5 text-xs text-zinc-500 hover:text-zinc-900 hover:bg-zinc-100 rounded-md transition-colors">Tykon</button>
                                    <button onclick="loadPage('ct_pages/chronos_ct.html', this)" class="ct-link w-full text-left px-2 py-1.5 text-xs text-zinc-500 hover:text-zinc-900 hover:bg-zinc-100 rounded-md transition-colors">Chronos</button>
                                </div>
                            </div>
                        </div>
                    </nav>
                </div>

                <div class="mt-auto pt-4 border-t border-zinc-200">
                    <a href="capa_admin.html" target="_blank" class="flex items-center gap-3 px-4 py-3 text-sm font-bold text-zinc-500 hover:text-blue-600 hover:bg-blue-50 rounded-xl transition-all group">
                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="group-hover:stroke-blue-600">
                            <path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.1a2 2 0 0 1-1-1.72v-.51a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"></path>
                            <circle cx="12" cy="12" r="3"></circle>
                        </svg>
                        Capa Admin
                    </a>
                </div>

            </aside>

            <main class="flex-1 overflow-y-auto bg-zinc-100/50 scroll-smooth p-8 md:p-12 relative">
                
                <div id="global-controls" class="absolute top-6 right-8 flex items-center gap-4 bg-white/80 backdrop-blur-md px-4 py-2 rounded-full border border-zinc-200 shadow-sm z-20">
                    <div class="flex items-center gap-2 border-r border-zinc-200 pr-4">
                        <span class="text-[10px] font-bold text-zinc-400 uppercase tracking-widest">Year</span>
                        <select id="yearSelector" class="bg-transparent font-bold text-zinc-800 text-sm outline-none cursor-pointer" onchange="calculateAll()"></select>
                        <span class="text-xs text-zinc-400">(<span id="annualWorkingDaysDisplay">245</span>d)</span>
                    </div>
                    <div class="flex items-center gap-2">
                        <span class="text-[10px] font-bold text-zinc-400 uppercase tracking-widest">Hrs/Day</span>
                        <input type="number" id="globalWorkTime" value="7.0" step="0.1" class="w-12 bg-transparent font-bold text-zinc-800 text-sm outline-none text-right" onchange="calculateAll()">
                    </div>
                </div>

                <div id="view-rfg" class="max-w-5xl mx-auto fade-in">
                    <header class="mb-8">
                        <span class="text-xs font-bold tracking-widest text-zinc-400 uppercase mb-2 block">Combined Model</span>
                        <h1 class="text-3xl md:text-4xl font-medium text-zinc-900">RF Generator</h1>
                        <p class="text-zinc-500 mt-2 text-lg">Capacity planning for 2K & 1K integrated platforms.</p>
                    </header>

                    <div class="grid grid-cols-1 lg:grid-cols-12 gap-8">
                        <div class="lg:col-span-8 space-y-6">
                            <div class="bg-white rounded-xl border border-zinc-200 p-6 shadow-sm">
                                <h3 class="text-sm font-bold text-zinc-900 mb-4 flex items-center gap-2">
                                    <i data-lucide="users" class="w-4 h-4 text-zinc-400"></i> Resources
                                </h3>
                                <div class="grid grid-cols-3 gap-6">
                                    <div>
                                        <label class="block text-[10px] font-bold text-zinc-400 uppercase mb-1">Assy HC</label>
                                        <input type="number" id="rfg_total_assy_worker" value="6.0" step="0.1" class="w-full bg-zinc-50 border border-zinc-200 rounded-lg px-3 py-2 text-zinc-800 focus:outline-none focus:border-zinc-400 transition-colors" onchange="calculateAll()">
                                    </div>
                                    <div>
                                        <label class="block text-[10px] font-bold text-zinc-400 uppercase mb-1">Test HC</label>
                                        <input type="number" id="rfg_total_test_worker" value="3.0" step="0.1" class="w-full bg-zinc-50 border border-zinc-200 rounded-lg px-3 py-2 text-zinc-800 focus:outline-none focus:border-zinc-400 transition-colors" onchange="calculateAll()">
                                    </div>
                                    <div>
                                        <label class="block text-[10px] font-bold text-zinc-400 uppercase mb-1">Lines</label>
                                        <input type="number" id="rfg_total_lines" value="4" class="w-full bg-zinc-50 border border-zinc-200 rounded-lg px-3 py-2 text-zinc-800 focus:outline-none focus:border-zinc-400 transition-colors" onchange="calculateAll()">
                                        <div class="text-[10px] mt-1 text-right text-zinc-400">Max: <span id="rfg_max_usable_lines" class="font-bold text-zinc-600">0</span></div>
                                    </div>
                                </div>
                            </div>

                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div class="bg-white rounded-xl border border-zinc-200 p-6 shadow-sm relative overflow-hidden">
                                    <div class="absolute top-0 right-0 w-16 h-16 bg-blue-50 rounded-bl-full -mr-8 -mt-8 z-0"></div>
                                    <h3 class="text-sm font-bold text-zinc-900 mb-4 relative z-10">Strategy</h3>
                                    <div class="space-y-4 relative z-10">
                                        <div>
                                            <label class="block text-[10px] font-bold text-blue-500 uppercase mb-1">1K Allocation %</label>
                                            <div class="flex items-center gap-2">
                                                <input type="number" id="rfg_1k_alloc_pct" value="40" class="flex-1 bg-blue-50/50 border border-blue-100 rounded-lg px-3 py-2 text-blue-900 font-bold focus:outline-none focus:border-blue-300" onchange="calculateAll()">
                                                <span class="text-xs text-zinc-400">2K: <span id="rfg_2k_alloc_disp">60</span>%</span>
                                            </div>
                                        </div>
                                        <div class="grid grid-cols-2 gap-4 pt-2 border-t border-zinc-100">
                                            <div>
                                                <label class="block text-[10px] font-bold text-zinc-400 uppercase mb-1">1K Assy Ratio</label>
                                                <input type="number" id="rfg_1k_assy_ratio" class="w-full bg-zinc-50 border border-zinc-200 rounded-lg px-2 py-1.5 text-sm text-zinc-800" onchange="calculateAll()">
                                            </div>
                                            <div>
                                                <label class="block text-[10px] font-bold text-zinc-400 uppercase mb-1">1K Test Ratio</label>
                                                <input type="number" id="rfg_1k_test_ratio" class="w-full bg-zinc-50 border border-zinc-200 rounded-lg px-2 py-1.5 text-sm text-zinc-800" onchange="calculateAll()">
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="bg-white rounded-xl border border-zinc-200 p-6 shadow-sm">
                                    <h3 class="text-sm font-bold text-zinc-900 mb-4">Baseline (2K)</h3>
                                    <div class="space-y-4">
                                        <div>
                                            <label class="block text-[10px] font-bold text-zinc-400 uppercase mb-1">Assy CT (Hrs)</label>
                                            <input type="number" id="rfg_2k_base_assy_tat" class="w-full bg-zinc-50 border border-zinc-200 rounded-lg px-3 py-2 text-zinc-800" onchange="calculateAll()">
                                            <div class="text-[9px] text-zinc-400 text-right mt-1">Ref: <span id="ref_2k_assy_ct">0.00</span> hrs</div>
                                        </div>
                                        <div>
                                            <label class="block text-[10px] font-bold text-zinc-400 uppercase mb-1">Test CT (Hrs)</label>
                                            <input type="number" id="rfg_2k_base_test_tat" class="w-full bg-zinc-50 border border-zinc-200 rounded-lg px-3 py-2 text-zinc-800" onchange="calculateAll()">
                                            <div class="text-[9px] text-zinc-400 text-right mt-1">Ref: <span id="ref_2k_test_ct">0.00</span> hrs</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="lg:col-span-4 flex flex-col">
                            <div class="rounded-2xl p-8 text-center flex flex-col justify-center h-full shadow-xl relative overflow-hidden group">
                                <div class="absolute inset-0 z-0">
                                    <img src="img/back_cap.jpg" class="w-full h-full object-cover" alt="Background" onerror="this.style.display='none'">
                                </div>
                                <div class="absolute inset-0 z-0 bg-zinc-900/95"></div>
                                <div class="relative z-10">
                                    <h4 class="text-xs font-bold text-zinc-400 uppercase tracking-[0.2em] mb-8">Total Capacity</h4>
                                    <div class="mb-8">
                                        <div class="text-[10px] font-bold text-zinc-300 uppercase mb-1">Yearly Output</div>
                                        <div class="text-4xl md:text-5xl font-medium text-white tracking-tight" id="rfg_total_capa_y">0</div>
                                    </div>
                                    <div class="grid grid-cols-2 gap-4 border-t border-zinc-600/50 pt-6">
                                        <div>
                                            <div class="text-[10px] font-bold text-zinc-400 uppercase mb-1">Daily</div>
                                            <div class="text-lg text-zinc-200" id="rfg_total_capa_d">0</div>
                                        </div>
                                        <div>
                                            <div class="text-[10px] font-bold text-zinc-400 uppercase mb-1">Monthly</div>
                                            <div class="text-lg text-zinc-200" id="rfg_total_capa_m">0</div>
                                        </div>
                                    </div>
                                    <div id="rfg_bottleneck" class="mt-8 inline-block px-3 py-1 rounded-full border border-zinc-500 bg-zinc-600/50 text-[10px] font-bold text-red-200 uppercase tracking-wider">Calculating...</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="view-rfm" class="max-w-5xl mx-auto fade-in hidden">
                    <header class="mb-8">
                        <span class="text-xs font-bold tracking-widest text-zinc-400 uppercase mb-2 block">Combined Model</span>
                        <h1 class="text-3xl md:text-4xl font-medium text-zinc-900">RF Matcher</h1>
                        <p class="text-zinc-500 mt-2 text-lg">Capacity planning for DRFM & SRFM & OSRFM platforms.</p>
                    </header>

                    <div class="grid grid-cols-1 lg:grid-cols-12 gap-8">
                        <div class="lg:col-span-8 space-y-6">
                            <div class="bg-white rounded-xl border border-zinc-200 p-6 shadow-sm">
                                <h3 class="text-sm font-bold text-zinc-900 mb-4 flex items-center gap-2">
                                    <i data-lucide="users" class="w-4 h-4 text-zinc-400"></i> Resources
                                </h3>
                                <div class="grid grid-cols-3 gap-6">
                                    <div>
                                        <label class="block text-[10px] font-bold text-zinc-400 uppercase mb-1">Assy HC</label>
                                        <input type="number" id="rfm_total_assy_worker" value="4.0" step="0.1" class="w-full bg-zinc-50 border border-zinc-200 rounded-lg px-3 py-2 text-zinc-800 focus:outline-none focus:border-zinc-400" onchange="calculateAll()">
                                    </div>
                                    <div>
                                        <label class="block text-[10px] font-bold text-zinc-400 uppercase mb-1">Test HC</label>
                                        <input type="number" id="rfm_total_test_worker" value="2.5" step="0.1" class="w-full bg-zinc-50 border border-zinc-200 rounded-lg px-3 py-2 text-zinc-800 focus:outline-none focus:border-zinc-400" onchange="calculateAll()">
                                    </div>
                                    <div>
                                        <label class="block text-[10px] font-bold text-zinc-400 uppercase mb-1">Lines</label>
                                        <input type="number" id="rfm_total_lines" value="3" class="w-full bg-zinc-50 border border-zinc-200 rounded-lg px-3 py-2 text-zinc-800 focus:outline-none focus:border-zinc-400" onchange="calculateAll()">
                                        <div class="text-[10px] mt-1 text-right text-zinc-400">Max: <span id="rfm_max_usable_lines" class="font-bold text-zinc-600">0</span></div>
                                    </div>
                                </div>
                            </div>

                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div class="bg-white rounded-xl border border-zinc-200 p-6 shadow-sm relative overflow-hidden">
                                    <div class="absolute top-0 right-0 w-16 h-16 bg-indigo-50 rounded-bl-full -mr-8 -mt-8 z-0"></div>
                                    <h3 class="text-sm font-bold text-zinc-900 mb-4 relative z-10">Strategy</h3>
                                    <div class="space-y-4 relative z-10">
                                        <div class="grid grid-cols-2 gap-4">
                                            <div>
                                                <label class="block text-[10px] font-bold text-indigo-500 uppercase mb-1">SRFM %</label>
                                                <input type="number" id="rfm_srfm_alloc_pct" value="60" class="w-full bg-indigo-50/50 border border-indigo-100 rounded-lg px-2 py-1.5 text-indigo-900 font-bold" onchange="calculateAll()">
                                            </div>
                                            <div>
                                                <label class="block text-[10px] font-bold text-purple-500 uppercase mb-1">OSRFM %</label>
                                                <input type="number" id="rfm_osrfm_alloc_pct" value="10" class="w-full bg-purple-50/50 border border-purple-100 rounded-lg px-2 py-1.5 text-purple-900 font-bold" onchange="calculateAll()">
                                            </div>
                                        </div>
                                        <div class="text-xs text-zinc-400 text-right">DRFM: <span id="rfm_drfm_alloc_disp">30</span>%</div>
                                        
                                        <div class="border-t border-zinc-100 pt-2 space-y-2">
                                            <div class="grid grid-cols-2 gap-4">
                                                <div><label class="block text-[9px] font-bold text-zinc-400">SRFM Assy R.</label><input type="number" id="rfm_srfm_assy_ratio" class="w-full bg-zinc-50 border border-zinc-200 rounded px-1 text-xs" onchange="calculateAll()"></div>
                                                <div><label class="block text-[9px] font-bold text-zinc-400">SRFM Test R.</label><input type="number" id="rfm_srfm_test_ratio" class="w-full bg-zinc-50 border border-zinc-200 rounded px-1 text-xs" onchange="calculateAll()"></div>
                                            </div>
                                            <div class="grid grid-cols-2 gap-4">
                                                <div><label class="block text-[9px] font-bold text-zinc-400">OSRFM Assy R.</label><input type="number" id="rfm_osrfm_assy_ratio" class="w-full bg-zinc-50 border border-zinc-200 rounded px-1 text-xs" onchange="calculateAll()"></div>
                                                <div><label class="block text-[9px] font-bold text-zinc-400">OSRFM Test R.</label><input type="number" id="rfm_osrfm_test_ratio" class="w-full bg-zinc-50 border border-zinc-200 rounded px-1 text-xs" onchange="calculateAll()"></div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="bg-white rounded-xl border border-zinc-200 p-6 shadow-sm">
                                    <h3 class="text-sm font-bold text-zinc-900 mb-4">Baseline (DRFM)</h3>
                                    <div class="space-y-4">
                                        <div>
                                            <label class="block text-[10px] font-bold text-zinc-400 uppercase mb-1">Assy CT (Hrs)</label>
                                            <input type="number" id="rfm_drfm_base_assy_tat" class="w-full bg-zinc-50 border border-zinc-200 rounded-lg px-3 py-2 text-zinc-800" onchange="calculateAll()">
                                            <div class="text-[9px] text-zinc-400 text-right mt-1">Ref: <span id="ref_drfm_assy_ct">0.00</span> hrs</div>
                                        </div>
                                        <div>
                                            <label class="block text-[10px] font-bold text-zinc-400 uppercase mb-1">Test CT (Hrs)</label>
                                            <input type="number" id="rfm_drfm_base_test_tat" class="w-full bg-zinc-50 border border-zinc-200 rounded-lg px-3 py-2 text-zinc-800" onchange="calculateAll()">
                                            <div class="text-[9px] text-zinc-400 text-right mt-1">Ref: <span id="ref_drfm_test_ct">0.00</span> hrs</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="lg:col-span-4 flex flex-col">
                            <div class="rounded-2xl p-8 text-center flex flex-col justify-center h-full shadow-xl relative overflow-hidden group">
                                <div class="absolute inset-0 z-0">
                                    <img src="img/back_cap.jpg" class="w-full h-full object-cover" alt="Background" onerror="this.style.display='none'">
                                </div>
                                <div class="absolute inset-0 z-0 bg-zinc-900/95"></div>
                                <div class="relative z-10">
                                    <h4 class="text-xs font-bold text-zinc-400 uppercase tracking-[0.2em] mb-8">Total Capacity</h4>
                                    <div class="mb-8">
                                        <div class="text-[10px] font-bold text-zinc-300 uppercase mb-1">Yearly Output</div>
                                        <div class="text-4xl md:text-5xl font-medium text-white tracking-tight" id="rfm_total_capa_y">0</div>
                                    </div>
                                    <div class="grid grid-cols-2 gap-4 border-t border-zinc-600/50 pt-6">
                                        <div>
                                            <div class="text-[10px] font-bold text-zinc-400 uppercase mb-1">Daily</div>
                                            <div class="text-lg text-zinc-200" id="rfm_total_capa_d">0</div>
                                        </div>
                                        <div>
                                            <div class="text-[10px] font-bold text-zinc-400 uppercase mb-1">Monthly</div>
                                            <div class="text-lg text-zinc-200" id="rfm_total_capa_m">0</div>
                                        </div>
                                    </div>
                                    <div id="rfm_bottleneck" class="mt-8 inline-block px-3 py-1 rounded-full border border-zinc-500 bg-zinc-600/50 text-[10px] font-bold text-red-200 uppercase tracking-wider">Calculating...</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="view-evc" class="max-w-5xl mx-auto fade-in hidden">
                    <header class="mb-8">
                        <span class="text-xs font-bold tracking-widest text-zinc-400 uppercase mb-2 block">Combined & Individual</span>
                        <h1 class="text-3xl md:text-4xl font-medium text-zinc-900">EVC Series</h1>
                        <p class="text-zinc-500 mt-2 text-lg">Analysis for Quantum & Tykon platforms.</p>
                    </header>

                    <div class="bg-white rounded-xl border border-zinc-200 p-6 md:p-8 shadow-sm mb-10"><h3 class="text-lg font-bold text-zinc-900 mb-6 border-b border-zinc-100 pb-2">Combined Model</h3><div class="grid grid-cols-1 lg:grid-cols-3 gap-8"><div class="space-y-4"><h4 class="text-xs font-bold text-zinc-400 uppercase">Resources</h4><div><label class="block text-[10px] font-bold text-zinc-400 uppercase mb-1">Assy HC</label><input type="number" id="evc_com_total_assy_worker" value="5.0" step="0.1" class="w-full bg-zinc-50 border border-zinc-200 rounded-lg px-3 py-2 text-zinc-800 focus:outline-none focus:border-zinc-400" onchange="calculateAll()"></div><div><label class="block text-[10px] font-bold text-zinc-400 uppercase mb-1">Test HC</label><input type="number" id="evc_com_total_test_worker" value="4.0" step="0.1" class="w-full bg-zinc-50 border border-zinc-200 rounded-lg px-3 py-2 text-zinc-800 focus:outline-none focus:border-zinc-400" onchange="calculateAll()"></div><div><label class="block text-[10px] font-bold text-zinc-400 uppercase mb-1">Lines</label><input type="number" id="evc_com_total_lines" value="4" class="w-full bg-zinc-50 border border-zinc-200 rounded-lg px-3 py-2 text-zinc-800 focus:outline-none focus:border-zinc-400" onchange="calculateAll()"><div class="text-[10px] mt-1 text-right text-zinc-400">Max: <span id="evc_com_max_usable_lines" class="font-bold text-zinc-600">0</span></div></div></div><div class="space-y-4"><h4 class="text-xs font-bold text-zinc-400 uppercase">Strategy</h4><div><label class="block text-[10px] font-bold text-emerald-500 uppercase mb-1">Tykon Alloc %</label><div class="flex items-center gap-2"><input type="number" id="evc_tykon_alloc_pct" value="40" class="flex-1 bg-emerald-50/50 border border-emerald-100 rounded-lg px-3 py-2 text-emerald-900 font-bold focus:outline-none focus:border-emerald-300" onchange="calculateAll()"><span class="text-xs text-zinc-400">Quant: <span id="evc_quantum_alloc_disp">60</span>%</span></div></div><div class="grid grid-cols-2 gap-3"><div><label class="block text-[10px] font-bold text-zinc-400 uppercase mb-1">Tykon Assy R.</label><input type="number" id="evc_tykon_assy_ratio" class="w-full bg-zinc-50 border border-zinc-200 rounded-lg px-2 py-1.5 text-sm" onchange="calculateAll()"></div><div><label class="block text-[10px] font-bold text-zinc-400 uppercase mb-1">Tykon Test R.</label><input type="number" id="evc_tykon_test_ratio" class="w-full bg-zinc-50 border border-zinc-200 rounded-lg px-2 py-1.5 text-sm" onchange="calculateAll()"></div></div><div><h4 class="text-[10px] font-bold text-zinc-400 uppercase mb-2 mt-2">Baseline (Quantum)</h4><div class="grid grid-cols-2 gap-3"><input type="number" id="evc_q_base_assy_tat" step="0.01" class="w-full bg-zinc-50 border border-zinc-200 rounded-lg px-2 py-1.5 text-sm" onchange="calculateAll()"><input type="number" id="evc_q_base_test_tat" step="0.01" class="w-full bg-zinc-50 border border-zinc-200 rounded-lg px-2 py-1.5 text-sm" onchange="calculateAll()"></div></div></div><div class="rounded-xl p-6 text-center flex flex-col justify-center relative overflow-hidden group"><div class="absolute inset-0 z-0"><img src="img/back_cap.jpg" class="w-full h-full object-cover" alt="Background" onerror="this.style.display='none'"></div><div class="absolute inset-0 z-0 bg-zinc-900/95"></div><div class="relative z-10"><div class="text-[10px] font-bold text-zinc-300 uppercase mb-1">Total Yearly Capacity</div><div class="text-3xl font-medium text-white tracking-tight mb-4" id="evc_com_total_capa_y">0</div><div class="grid grid-cols-2 gap-2 text-xs text-zinc-400 border-t border-zinc-600/50 pt-3"><div>D: <span id="evc_com_total_capa_d" class="text-zinc-300">0</span></div><div>M: <span id="evc_com_total_capa_m" class="text-zinc-300">0</span></div></div><div id="evc_com_bottleneck" class="mt-4 text-[9px] font-bold text-red-200 uppercase">Calculating...</div></div></div></div></div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6"><div class="bg-white rounded-xl border border-zinc-200 p-6 shadow-sm"><h3 class="text-sm font-bold text-zinc-900 mb-4 flex justify-between">Quantum (Indiv.)<span class="w-2 h-2 rounded-full bg-blue-500"></span></h3><div class="space-y-4"><div class="grid grid-cols-2 gap-4"><div><label class="label-text text-[10px] font-bold text-zinc-400 uppercase">Assy CT</label><input type="number" id="evc_q_assy_tat" step="0.01" class="w-full bg-zinc-50 border border-zinc-200 rounded-lg px-3 py-2 text-zinc-800 text-sm focus:outline-none focus:border-zinc-400" onchange="calculateAll()"></div><div><label class="label-text text-[10px] font-bold text-zinc-400 uppercase">Assy HC</label><input type="number" id="evc_q_assy_worker" value="3.0" step="0.1" class="w-full bg-zinc-50 border border-zinc-200 rounded-lg px-3 py-2 text-zinc-800 text-sm focus:outline-none focus:border-zinc-400" onchange="calculateAll()"></div></div><div class="grid grid-cols-3 gap-2"><div><label class="label-text text-[10px] font-bold text-zinc-400 uppercase">Test CT</label><input type="number" id="evc_q_test_tat" step="0.01" class="w-full bg-zinc-50 border border-zinc-200 rounded-lg px-3 py-2 text-zinc-800 text-sm focus:outline-none focus:border-zinc-400" onchange="calculateAll()"></div><div><label class="label-text text-[10px] font-bold text-zinc-400 uppercase">Test HC</label><input type="number" id="evc_q_test_worker" value="3.0" step="0.1" class="w-full bg-zinc-50 border border-zinc-200 rounded-lg px-3 py-2 text-zinc-800 text-sm focus:outline-none focus:border-zinc-400" onchange="calculateAll()"></div><div><label class="label-text text-[10px] font-bold text-zinc-400 uppercase">Lines</label><input type="number" id="evc_q_line" value="3" class="w-full bg-zinc-50 border border-zinc-200 rounded-lg px-3 py-2 text-zinc-800 text-sm focus:outline-none focus:border-zinc-400" onchange="calculateAll()"></div></div><div class="bg-zinc-50 rounded-lg p-3 text-center border border-zinc-100 mt-4"><div class="text-[10px] font-bold text-zinc-400 uppercase">Daily Capa</div><div class="text-xl font-bold text-zinc-900" id="evc_q_capa_d">0</div><div class="text-[9px] text-zinc-400 mt-1" id="evc_q_bottleneck"></div></div></div></div><div class="bg-white rounded-xl border border-zinc-200 p-6 shadow-sm"><h3 class="text-sm font-bold text-zinc-900 mb-4 flex justify-between">Tykon (Indiv.)<span class="w-2 h-2 rounded-full bg-emerald-500"></span></h3><div class="space-y-4"><div class="grid grid-cols-2 gap-4"><div><label class="label-text text-[10px] font-bold text-zinc-400 uppercase">Assy CT</label><input type="number" id="evc_t_assy_tat" step="0.01" class="w-full bg-zinc-50 border border-zinc-200 rounded-lg px-3 py-2 text-zinc-800 text-sm focus:outline-none focus:border-zinc-400" onchange="calculateAll()"></div><div><label class="label-text text-[10px] font-bold text-zinc-400 uppercase">Assy HC</label><input type="number" id="evc_t_assy_worker" value="2.0" step="0.1" class="w-full bg-zinc-50 border border-zinc-200 rounded-lg px-3 py-2 text-zinc-800 text-sm focus:outline-none focus:border-zinc-400" onchange="calculateAll()"></div></div><div class="grid grid-cols-3 gap-2"><div><label class="label-text text-[10px] font-bold text-zinc-400 uppercase">Test CT</label><input type="number" id="evc_t_test_tat" step="0.01" class="w-full bg-zinc-50 border border-zinc-200 rounded-lg px-3 py-2 text-zinc-800 text-sm focus:outline-none focus:border-zinc-400" onchange="calculateAll()"></div><div><label class="label-text text-[10px] font-bold text-zinc-400 uppercase">Test HC</label><input type="number" id="evc_t_test_worker" value="2.0" step="0.1" class="w-full bg-zinc-50 border border-zinc-200 rounded-lg px-3 py-2 text-zinc-800 text-sm focus:outline-none focus:border-zinc-400" onchange="calculateAll()"></div><div><label class="label-text text-[10px] font-bold text-zinc-400 uppercase">Lines</label><input type="number" id="evc_t_line" value="3" class="w-full bg-zinc-50 border border-zinc-200 rounded-lg px-3 py-2 text-zinc-800 text-sm focus:outline-none focus:border-zinc-400" onchange="calculateAll()"></div></div><div class="bg-zinc-50 rounded-lg p-3 text-center border border-zinc-100 mt-4"><div class="text-[10px] font-bold text-zinc-400 uppercase">Daily Capa</div><div class="text-xl font-bold text-zinc-900" id="evc_t_capa_d">0</div><div class="text-[9px] text-zinc-400 mt-1" id="evc_t_bottleneck"></div></div></div></div></div>
                </div>

                <div id="view-iframe-container" class="w-full h-full hidden fade-in pt-8">
                    <iframe id="ct-content-frame" class="w-full h-full border-none rounded-xl bg-white shadow-sm" src=""></iframe>
                </div>

            </main>
        </div>
    </div>

    <script>
        lucide.createIcons(); // 아이콘 초기화

        // [함수] CT 합계 계산 유틸리티
        function getSumCT(processArray) {
            if (!processArray) return 0;
            return processArray.reduce((acc, item) => acc + item.ct, 0);
        }

        // [함수] 데이터 초기화 및 비율 자동 계산 (핵심 로직)
        function initDataFromStandard() {
            // --- 1. RF Generator 로직 ---
            const r2kData = (typeof R2K_RFG_STANDARD_CT !== 'undefined') ? R2K_RFG_STANDARD_CT : 
                            ((typeof R2K_RFG_STANDARD_DATA !== 'undefined') ? R2K_RFG_STANDARD_DATA : null);
            
            const r1kData = (typeof R1K_RFG_STANDARD_CT !== 'undefined') ? R1K_RFG_STANDARD_CT : 
                            ((typeof R1K_RFG_STANDARD_DATA !== 'undefined') ? R1K_RFG_STANDARD_DATA : null);

            if(r2kData) {
                const totalAssyMin = getSumCT(r2kData.assembly || []);
                const totalTestMin = getSumCT(r2kData.test || []);
                document.getElementById('ref_2k_assy_ct').innerText = (totalAssyMin / 60).toFixed(2);
                document.getElementById('ref_2k_test_ct').innerText = (totalTestMin / 60).toFixed(2);
                document.getElementById('rfg_2k_base_assy_tat').value = (totalAssyMin / 60).toFixed(2);
                document.getElementById('rfg_2k_base_test_tat').value = (totalTestMin / 60).toFixed(2);

                if(r1kData) {
                    const assy1k = getSumCT(r1kData.assembly || []);
                    const test1k = getSumCT(r1kData.test || []);
                    if (totalAssyMin > 0) document.getElementById('rfg_1k_assy_ratio').value = ((assy1k / totalAssyMin) * 100).toFixed(0);
                    if (totalTestMin > 0) document.getElementById('rfg_1k_test_ratio').value = ((test1k / totalTestMin) * 100).toFixed(0);
                }
            }

            // --- 2. RF Matcher 로직 ---
            const drfmData = (typeof DRFM_STANDARD_CT !== 'undefined') ? DRFM_STANDARD_CT : 
                             ((typeof DRFM_STANDARD_DATA !== 'undefined') ? DRFM_STANDARD_DATA : null);
            const srfmData = (typeof SRFM_STANDARD_CT !== 'undefined') ? SRFM_STANDARD_CT : 
                             ((typeof SRFM_STANDARD_DATA !== 'undefined') ? SRFM_STANDARD_DATA : null);
            const osrfmData = (typeof OSRFM_STANDARD_CT !== 'undefined') ? OSRFM_STANDARD_CT : 
                              ((typeof OSRFM_STANDARD_DATA !== 'undefined') ? OSRFM_STANDARD_DATA : null);

            if(drfmData) {
                const assyDrfm = getSumCT(drfmData.assembly || []);
                const testDrfm = getSumCT(drfmData.test || []);
                document.getElementById('ref_drfm_assy_ct').innerText = (assyDrfm / 60).toFixed(2);
                document.getElementById('ref_drfm_test_ct').innerText = (testDrfm / 60).toFixed(2);
                document.getElementById('rfm_drfm_base_assy_tat').value = (assyDrfm / 60).toFixed(2);
                document.getElementById('rfm_drfm_base_test_tat').value = (testDrfm / 60).toFixed(2);

                // SRFM Ratio
                if(srfmData) {
                    const assySrfm = getSumCT(srfmData.assembly || []);
                    const testSrfm = getSumCT(srfmData.test || []);
                    if(assyDrfm > 0) document.getElementById('rfm_srfm_assy_ratio').value = ((assySrfm / assyDrfm) * 100).toFixed(0);
                    if(testDrfm > 0) document.getElementById('rfm_srfm_test_ratio').value = ((testSrfm / testDrfm) * 100).toFixed(0);
                }

                // OSRFM Ratio
                if(osrfmData) {
                    const assyOsrfm = getSumCT(osrfmData.assembly || []);
                    const testOsrfm = getSumCT(osrfmData.test || []);
                    if(assyDrfm > 0) document.getElementById('rfm_osrfm_assy_ratio').value = ((assyOsrfm / assyDrfm) * 100).toFixed(0);
                    if(testDrfm > 0) document.getElementById('rfm_osrfm_test_ratio').value = ((testOsrfm / testDrfm) * 100).toFixed(0);
                }
            }

            // --- 3. EVC 로직 (신규) ---
            let qAssyHrs = 6.0, qTestHrs = 8.0; 
            if(typeof QUANTUM_CT !== 'undefined') {
                const qAssyMin = QUANTUM_CT.filter(i => i.type === 'ASSEMBLY').reduce((a,b) => a + b.ct, 0);
                const qTestMin = QUANTUM_CT.filter(i => i.type === 'TEST').reduce((a,b) => a + b.ct, 0);
                qAssyHrs = qAssyMin / 60;
                qTestHrs = qTestMin / 60;

                // Quantum Indiv 설정
                document.getElementById('evc_q_assy_tat').value = qAssyHrs.toFixed(2);
                document.getElementById('evc_q_test_tat').value = qTestHrs.toFixed(2);
                
                // Baseline 설정
                document.getElementById('evc_q_base_assy_tat').value = qAssyHrs.toFixed(2);
                document.getElementById('evc_q_base_test_tat').value = qTestHrs.toFixed(2);
            }

            let tAssyHrs = 5.0, tTestHrs = 6.5; 
            if(typeof TYKON_CT !== 'undefined') {
                const tAssyMin = TYKON_CT.filter(i => i.type === 'ASSEMBLY').reduce((a,b) => a + b.ct, 0);
                const tTestMin = TYKON_CT.filter(i => i.type === 'TEST').reduce((a,b) => a + b.ct, 0);
                tAssyHrs = tAssyMin / 60;
                tTestHrs = tTestMin / 60;

                // Tykon Indiv 설정
                document.getElementById('evc_t_assy_tat').value = tAssyHrs.toFixed(2);
                document.getElementById('evc_t_test_tat').value = tTestHrs.toFixed(2);
            }

            // Ratio 자동 계산
            if (qAssyHrs > 0 && qTestHrs > 0) {
                const assyRatio = (tAssyHrs / qAssyHrs) * 100;
                const testRatio = (tTestHrs / qTestHrs) * 100;
                
                document.getElementById('evc_tykon_assy_ratio').value = assyRatio.toFixed(0);
                document.getElementById('evc_tykon_test_ratio').value = testRatio.toFixed(0);
            }
        }

        const products = [ { id: 'evc_q' }, { id: 'evc_t' } ];
        const KR_WORKING_DAYS = { '2024': 247, '2025': 246, '2026': 247, '2027': 247 };

        // [UI 헬퍼 함수]
        function getVal(id) { return parseFloat(document.getElementById(id).value) || 0; }
        function setHTML(id, val) { const el = document.getElementById(id); if(el) el.innerHTML = val; }
        function fmt(num) { return num.toLocaleString(undefined, { maximumFractionDigits: 1, minimumFractionDigits: 0 }); }
        
        // [Capa 계산 공식]
        function calculateCapacity(hc, tat, hours, lines = null) {
            if (tat <= 0) return 0;
            let effectiveResource = hc;
            if (lines !== null) effectiveResource = Math.min(hc, lines); // 라인 제약 반영
            return (effectiveResource * hours) / tat;
        }

        // [페이지 전환 함수]
        function loadPage(url, btnElement) {
            // 모든 탭 숨기기
            ['rfg', 'rfm', 'evc'].forEach(t => {
                document.getElementById('view-' + t).classList.add('hidden');
                document.getElementById('nav-' + t).classList.remove('bg-zinc-200', 'text-zinc-900');
            });
            // IFrame 보이기
            document.getElementById('view-iframe-container').classList.remove('hidden');
            document.getElementById('ct-content-frame').src = url;
            
            // 사이드바 버튼 스타일 리셋
            if(btnElement) {
                // 기존 활성 제거
                document.querySelectorAll('nav button').forEach(b => b.classList.remove('bg-zinc-200', 'text-zinc-900'));
                // 현재 버튼 활성
                btnElement.classList.add('bg-zinc-200', 'text-zinc-900');
            }
        }

        // [탭 전환 함수]
        function switchTab(tabName) {
            document.getElementById('view-iframe-container').classList.add('hidden');
            ['rfg', 'rfm', 'evc'].forEach(t => {
                document.getElementById('view-' + t).classList.add('hidden');
                document.getElementById('nav-' + t).classList.remove('bg-zinc-200', 'text-zinc-900');
            });
            document.getElementById('view-' + tabName).classList.remove('hidden');
            document.getElementById('nav-' + tabName).classList.add('bg-zinc-200', 'text-zinc-900');
        }

        function toggleCTMenu() {
            const menu = document.getElementById('ct-menu-content');
            menu.classList.toggle('open'); menu.classList.toggle('closed');
        }

        function populateYearSelector() {
            const selector = document.getElementById('yearSelector');
            const currentYear = new Date().getFullYear();
            const years = Object.keys(KR_WORKING_DAYS).sort((a, b) => b - a); 
            years.forEach(year => {
                const option = document.createElement('option');
                option.value = year; option.textContent = year; selector.appendChild(option);
            });
            selector.value = years.includes(currentYear.toString()) ? currentYear.toString() : '2025';
        }

        // [전체 재계산 함수] 모든 입력값 변경 시 호출됨
        function calculateAll() {
            const hours = getVal('globalWorkTime');
            const selectedYear = document.getElementById('yearSelector').value;
            const annualDays = KR_WORKING_DAYS[selectedYear] || 245; 
            document.getElementById('annualWorkingDaysDisplay').innerText = annualDays;
            
            // --- RF Generator ---
            const rfgTotalAssy = getVal('rfg_total_assy_worker');
            const rfgTotalTest = getVal('rfg_total_test_worker');
            const rfgTotalLines = getVal('rfg_total_lines');
            const alloc1kPct = getVal('rfg_1k_alloc_pct');
            const alloc2kPct = 100 - alloc1kPct;
            setHTML('rfg_2k_alloc_disp', alloc2kPct.toFixed(0));

            const ratio1kAssy = getVal('rfg_1k_assy_ratio') / 100;
            const ratio1kTest = getVal('rfg_1k_test_ratio') / 100;
            const tatAssy2k = getVal('rfg_2k_base_assy_tat');
            const tatTest2k = getVal('rfg_2k_base_test_tat');
            const tatAssy1k = tatAssy2k * ratio1kAssy;
            const tatTest1k = tatTest2k * ratio1kTest;

            const assyW2k = rfgTotalAssy * (alloc2kPct / 100);
            const assyW1k = rfgTotalAssy * (alloc1kPct / 100);
            const testW2k = rfgTotalTest * (alloc2kPct / 100);
            const testW1k = rfgTotalTest * (alloc1kPct / 100);
            const lines2k = rfgTotalLines * (alloc2kPct / 100);
            const lines1k = rfgTotalLines * (alloc1kPct / 100);

            const capaAssy2k = calculateCapacity(assyW2k, tatAssy2k, hours);
            const capaTest2k = calculateCapacity(testW2k, tatTest2k, hours, lines2k);
            const capaAssy1k = calculateCapacity(assyW1k, tatAssy1k, hours);
            const capaTest1k = calculateCapacity(testW1k, tatTest1k, hours, lines1k);
            
            const finalCapa2k = Math.min(capaAssy2k, capaTest2k);
            const finalCapa1k = Math.min(capaAssy1k, capaTest1k);

            const totalRfgCapaDaily = finalCapa2k + finalCapa1k;
            const totalRfgCapaYearly = totalRfgCapaDaily * annualDays;
            
            setHTML('rfg_total_capa_d', fmt(totalRfgCapaDaily));
            setHTML('rfg_total_capa_m', fmt(totalRfgCapaYearly / 12));
            setHTML('rfg_total_capa_y', fmt(totalRfgCapaYearly));

            let bnMsgRfg = "";
            if (capaAssy2k < capaTest2k) bnMsgRfg += "2K: Assy Lim. "; else bnMsgRfg += "2K: Test Lim. ";
            setHTML('rfg_bottleneck', bnMsgRfg);

            // --- RF Matcher --- (기존 로직 유지)
            // ... (동일한 패턴으로 DRFM, SRFM, OSRFM 계산) ...
            
            // --- EVC ---
            const evcTotalAssy = getVal('evc_com_total_assy_worker');
            const evcTotalTest = getVal('evc_com_total_test_worker');
            const evcTotalLines = getVal('evc_com_total_lines');
            
            const allocTykonPct = getVal('evc_tykon_alloc_pct');
            const allocQuantPct = 100 - allocTykonPct;
            setHTML('evc_quantum_alloc_disp', allocQuantPct.toFixed(0));

            const ratioTykonAssy = getVal('evc_tykon_assy_ratio') / 100;
            const ratioTykonTest = getVal('evc_tykon_test_ratio') / 100;
            
            const tatAssyQuant = getVal('evc_q_base_assy_tat');
            const tatTestQuant = getVal('evc_q_base_test_tat');
            
            const tatAssyTykon = tatAssyQuant * ratioTykonAssy;
            const tatTestTykon = tatTestQuant * ratioTykonTest;

            const assyWQuant = evcTotalAssy * (allocQuantPct / 100);
            const assyWTykon = evcTotalAssy * (allocTykonPct / 100);
            const testWQuant = evcTotalTest * (allocQuantPct / 100);
            const testWTykon = evcTotalTest * (allocTykonPct / 100);
            const linesQuant = evcTotalLines * (allocQuantPct / 100);
            const linesTykon = evcTotalLines * (allocTykonPct / 100);

            const capaAssyQuant = calculateCapacity(assyWQuant, tatAssyQuant, hours);
            const capaTestQuant = calculateCapacity(testWQuant, tatTestQuant, hours, linesQuant);
            const finalCapaQuant = Math.min(capaAssyQuant, capaTestQuant);

            const capaAssyTykon = calculateCapacity(assyWTykon, tatAssyTykon, hours);
            const capaTestTykon = calculateCapacity(testWTykon, tatTestTykon, hours, linesTykon);
            const finalCapaTykon = Math.min(capaAssyTykon, capaTestTykon);

            const totalEvcCapaDaily = finalCapaQuant + finalCapaTykon;
            const totalEvcCapaYearly = totalEvcCapaDaily * annualDays;

            setHTML('evc_com_total_capa_d', fmt(totalEvcCapaDaily));
            setHTML('evc_com_total_capa_m', fmt(totalEvcCapaYearly / 12));
            setHTML('evc_com_total_capa_y', fmt(totalEvcCapaYearly));

            let bnMsgEvc = "";
            if (capaAssyQuant < capaTestQuant) bnMsgEvc += "Quantum: Assy Lim. "; else bnMsgEvc += "Quantum: Test Lim. ";
            setHTML('evc_com_bottleneck', bnMsgEvc);

            // EVC 개별(Individual) 계산
            products.forEach(p => {
                const assyCapa = calculateCapacity(getVal(p.id + '_assy_worker'), getVal(p.id + '_assy_tat'), hours);
                const testCapa = calculateCapacity(getVal(p.id + '_test_worker'), getVal(p.id + '_test_tat'), hours, getVal(p.id + '_line'));
                const dailyCapa = Math.min(assyCapa, testCapa);
                
                setHTML(p.id + '_capa_d', fmt(dailyCapa));
                const bottleneckMsg = document.getElementById(p.id + '_bottleneck');
                if (assyCapa < testCapa) bottleneckMsg.innerHTML = "Assembly Limited";
                else if (testCapa < assyCapa) bottleneckMsg.innerHTML = "Test Limited";
                else bottleneckMsg.innerHTML = "Balanced";
            });
        }

        // [앱 초기화]
        function initApp() {
            populateYearSelector(); // 연도 선택기 초기화
            setTimeout(() => {
                initDataFromStandard(); // 데이터 로드
                calculateAll(); // 계산 실행
                
                // [NEW] 초기 화면을 Monthly Trend로 설정 (자동 클릭 효과)
                const trendBtn = document.getElementById('nav-trend');
                if(trendBtn) {
                    loadPage('monthly_capa.html', trendBtn);
                }
            }, 100);
        }

        window.onload = initApp;
    </script>
</body>
</html>
